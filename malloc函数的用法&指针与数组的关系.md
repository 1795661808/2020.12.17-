## malloc函数的用法&指针与数组的关系

malloc 是 memory allocate 的缩写



[TOC]



##### 传统数组的缺点

1.数组长度必须事先制定,且只能是常整数,不能是变量 

​		1.例子  int a[5]//true   int len = 5; int a[len]; //error

2.传统形式定义的数组，该数组的内存程序员无法手动释放， 在一个函数运行期间，系统为该函数中数组所分配的空间会一直存在，知道该数组运行完毕时，数组的空间才会被系统释放

3.数组的长度一旦定义，其长度就不能再更改，数组的长度不能在函数运行的过程中动态的扩充和缩小

4.A函数定义的数组，在A函数运行期间可以被其他函数使用，但A函数运行完毕之后，A函数中的数组将无法在被其他函数使用

##### 指针与数组的关系 

本质上,数组就是一串连续的数据 然后数组名是一个起始地址(常量 不可修改)

如果 new一个指针  且利用malloc函数去分配了 一长串的 数据 那么在指针的后面加上[]就成为了数组 



##### malloc函数的用法

```c++
#include<malloc.h>
int main(void)
{
    int i = 5; //分配了4个字节 静态分配 
    int * p =(int *)malloc(sizeof(int)); 
    
    *p= 5;
    
    free(p);
    return 0;
}
```

1. 要使用malloc函数，必须添加malloc.h这个头文件 

2. malloc函数只有一个形参,并且形参是整型

3.  4表示请求系统为本程序分配4个字节

4. malloc函数只能返回第一个字节的地址

5. 第五行 分配了8个字节,p变量占4个字节,p所指向的内存也占4个字节

6. p本身所占的内存是静态分配的,p所指向的内存是动态分配的
7. free(p) 表示把p所指向的内存给释放掉  注意:p本身的内存是静态的,不能由程序员手动释放,p本身的内存只能在p变量所在的函数运行终止时由系统自动释放
8. \*p  = 5; //*p代表的就是一个int变量,只不过\*p这个整型变量的内存分配方式和4行的i变量的分配方式不同

##### 动态内存分配举例_动态一维数组的构造

如果pArr指向前四个字节(int)

​		pArr+1就是指向后四个字节  也就是数组的下标加1\



静态

​		int a[5];



动态

​		int * pArr;  pArr = (int *)malloc(4 * len);//本行动态的构造了一个一维数组,该一维数组的长度是len,该数组的数组名是pArr,该数组的每一个元素是int类型 类似于 int pArr[len];

​		上式等价于 pArr[?]



##### 动态内存和静态内存的比较

静态内存是由系统自动分配,由系统自动释放

静态内存是在栈分配的



动态内存是由程序员手动分配,手动释放

动态内存是在堆分配的



